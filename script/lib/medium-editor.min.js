function MediumEditor(b,a){return this.init(b,a)}if(typeof module==="object"){module.exports=MediumEditor}(function(d,a){function g(h,i){var j;if(h===undefined){return i}for(j in i){if(i.hasOwnProperty(j)&&h.hasOwnProperty(j)===false){h[j]=i[j]}}return h}function c(){var k,h,j,l=d.getSelection();if(l.getRangeAt&&l.rangeCount){j=[];for(k=0,h=l.rangeCount;k<h;k+=1){j.push(l.getRangeAt(k))}return j}return null}function e(l){var j,h,k=d.getSelection();if(l){k.removeAllRanges();for(j=0,h=l.length;j<h;j+=1){k.addRange(l[j])}}}function b(){var i=a.getSelection().anchorNode,h=(i&&i.nodeType===3?i.parentNode:i);return h}function f(){var l,k="",m,h,j;if(d.getSelection!==undefined){m=d.getSelection();if(m.rangeCount){j=a.createElement("div");for(l=0,h=m.rangeCount;l<h;l+=1){j.appendChild(m.getRangeAt(l).cloneContents())}k=j.innerHTML}}else{if(a.selection!==undefined){if(a.selection.type==="Text"){k=a.selection.createRange().htmlText}}}return k}MediumEditor.prototype={defaults:{allowMultiParagraphSelection:true,anchorInputPlaceholder:"Paste or type a link",buttons:["bold","italic","underline","anchor","header1","header2","quote"],buttonLabels:false,delay:0,diffLeft:0,diffTop:-10,disableReturn:false,disableToolbar:false,firstHeader:"h3",forcePlainText:true,placeholder:"Type your text",secondHeader:"h4",targetBlank:false},init:function(i,h){this.elements=typeof i==="string"?a.querySelectorAll(i):i;if(this.elements.length===0){return}this.isActive=true;this.parentElements=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"];this.id=a.querySelectorAll(".medium-editor-toolbar").length+1;this.options=g(h,this.defaults);return this.initElements().bindSelect().bindPaste().setPlaceholders().bindWindowActions()},initElements:function(){var h,j=false;for(h=0;h<this.elements.length;h+=1){this.elements[h].setAttribute("contentEditable",true);if(!this.elements[h].getAttribute("data-placeholder")){this.elements[h].setAttribute("data-placeholder",this.options.placeholder)}this.elements[h].setAttribute("data-medium-element",true);this.bindParagraphCreation(h).bindReturn(h).bindTab(h).bindAnchorPreview(h);if(!this.options.disableToolbar&&!this.elements[h].getAttribute("data-disable-toolbar")){j=true}}if(j){this.initToolbar().bindButtons().bindAnchorForm()}return this},serialize:function(){$("div.medium-remove-content").each(function(){$(this).replaceWith($(this).children())});var j,h,k={};for(j=0;j<this.elements.length;j+=1){h=(this.elements[j].id!=="")?this.elements[j].id:"element-"+j;k[h]={value:this.elements[j].innerHTML.trim()}}return k},bindParagraphCreation:function(i){var h=this;this.elements[i].addEventListener("keyup",function(l){var k=b(),j;if(k&&k.getAttribute("data-medium-element")&&k.children.length===0&&!(h.options.disableReturn||k.getAttribute("data-disable-return"))){a.execCommand("formatBlock",false,"p")}if(l.which===13&&!l.shiftKey){k=b();j=k.tagName.toLowerCase();if(!(h.options.disableReturn||this.getAttribute("data-disable-return"))&&j!=="li"&&!h.isListItemChild(k)){a.execCommand("formatBlock",false,"p");if(j==="a"){a.execCommand("unlink",false,null)}}}});return this},isListItemChild:function(j){var h=j.parentNode,i=h.tagName.toLowerCase();while(this.parentElements.indexOf(i)===-1&&i!=="div"){if(i==="li"){return true}h=h.parentNode;if(h&&h.tagName){i=h.tagName.toLowerCase()}else{return false}}return false},bindReturn:function(i){var h=this;this.elements[i].addEventListener("keypress",function(j){if(j.which===13){if(h.options.disableReturn||this.getAttribute("data-disable-return")){j.preventDefault()}}});return this},bindTab:function(h){this.elements[h].addEventListener("keydown",function(j){if(j.which===9){var i=b().tagName.toLowerCase();if(i==="pre"){j.preventDefault();a.execCommand("insertHtml",null,"    ")}}});return this},buttonTemplate:function(h){var j=this.getButtonLabels(this.options.buttonLabels),i={bold:'<li><button class="medium-editor-action medium-editor-action-bold" data-action="bold" data-element="b">'+j.bold+"</button></li>",italic:'<li><button class="medium-editor-action medium-editor-action-italic" data-action="italic" data-element="i">'+j.italic+"</button></li>",underline:'<li><button class="medium-editor-action medium-editor-action-underline" data-action="underline" data-element="u">'+j.underline+"</button></li>",strikethrough:'<li><button class="medium-editor-action medium-editor-action-strikethrough" data-action="strikethrough" data-element="strike"><strike>A</strike></button></li>',superscript:'<li><button class="medium-editor-action medium-editor-action-superscript" data-action="superscript" data-element="sup">'+j.superscript+"</button></li>",subscript:'<li><button class="medium-editor-action medium-editor-action-subscript" data-action="subscript" data-element="sub">'+j.subscript+"</button></li>",anchor:'<li><button class="medium-editor-action medium-editor-action-anchor" data-action="anchor" data-element="a">'+j.anchor+"</button></li>",image:'<li><button class="medium-editor-action medium-editor-action-image" data-action="image" data-element="img">'+j.image+"</button></li>",youtube:'<li><button class="medium-editor-action medium-editor-action-youtube" data-action="youtube" data-element="img">'+j.youtube+"</button></li>",header1:'<li><button class="medium-editor-action medium-editor-action-header1" data-action="append-'+this.options.firstHeader+'" data-element="'+this.options.firstHeader+'">'+j.header1+"</button></li>",header2:'<li><button class="medium-editor-action medium-editor-action-header2" data-action="append-'+this.options.secondHeader+'" data-element="'+this.options.secondHeader+'">'+j.header2+"</button></li>",quote:'<li><button class="medium-editor-action medium-editor-action-quote" data-action="append-blockquote" data-element="blockquote">'+j.quote+"</button></li>",orderedlist:'<li><button class="medium-editor-action medium-editor-action-orderedlist" data-action="insertorderedlist" data-element="ol">'+j.orderedlist+"</button></li>",unorderedlist:'<li><button class="medium-editor-action medium-editor-action-unorderedlist" data-action="insertunorderedlist" data-element="ul">'+j.unorderedlist+"</button></li>",pre:'<li><button class="medium-editor-action medium-editor-action-pre" data-action="append-pre" data-element="pre">'+j.pre+"</button></li>"};return i[h]||false},getButtonLabels:function(h){var i,j,k={bold:"<b>B</b>",italic:"<b><i>I</i></b>",underline:"<b><u>U</u></b>",superscript:"<b>x<sup>1</sup></b>",subscript:"<b>x<sub>1</sup></b>",anchor:"<b>#</b>",image:"<b>image</b>",youtube:"<b>youtube</b>",header1:"<b>H1</b>",header2:"<b>H2</b>",quote:"<b>&ldquo;</b>",orderedlist:"<b>1.</b>",unorderedlist:"<b>&bull;</b>",pre:"<b>0101</b>"};if(h==="fontawesome"){i={bold:'<i class="fa fa-bold"></i>',italic:'<i class="fa fa-italic"></i>',underline:'<i class="fa fa-underline"></i>',superscript:'<i class="fa fa-superscript"></i>',subscript:'<i class="fa fa-subscript"></i>',anchor:'<i class="fa fa-link"></i>',image:'<i class="fa fa-picture-o"></i>',youtube:'<i class="fa fa-video-o"></i>',quote:'<i class="fa fa-quote-right"></i>',orderedlist:'<i class="fa fa-list-ol"></i>',unorderedlist:'<i class="fa fa-list-ul"></i>',pre:'<i class="fa fa-code fa-lg"></i>'}}else{if(typeof h==="object"){i=h}}if(typeof i==="object"){for(j in i){if(i.hasOwnProperty(j)){k[j]=i[j]}}}return k},toolbarTemplate:function(){var l=this.options.buttons,k='<ul id="medium-editor-toolbar-actions" class="medium-editor-toolbar-actions clearfix">',j,h;for(j=0;j<l.length;j+=1){h=this.buttonTemplate(l[j]);if(h){k+=h}}k+='</ul><div class="medium-editor-toolbar-form-anchor" id="medium-editor-toolbar-form-anchor">    <input type="text" value="" placeholder="'+this.options.anchorInputPlaceholder+'">    <a href="#">&times;</a></div>';return k},initToolbar:function(){if(this.toolbar){return this}this.toolbar=this.createToolbar();this.keepToolbarAlive=false;this.anchorForm=this.toolbar.querySelector(".medium-editor-toolbar-form-anchor");this.anchorInput=this.anchorForm.querySelector("input");this.toolbarActions=this.toolbar.querySelector(".medium-editor-toolbar-actions");this.anchorPreview=this.createAnchorPreview();return this},createToolbar:function(){var h=a.createElement("div");h.id="medium-editor-toolbar-"+this.id;h.className="medium-editor-toolbar";h.innerHTML=this.toolbarTemplate();a.getElementsByTagName("body")[0].appendChild(h);return h},bindSelect:function(){var h=this,k="",j;this.checkSelectionWrapper=function(){clearTimeout(k);k=setTimeout(function(){h.checkSelection()},h.options.delay)};a.documentElement.addEventListener("mouseup",this.checkSelectionWrapper);for(j=0;j<this.elements.length;j+=1){this.elements[j].addEventListener("keyup",this.checkSelectionWrapper);this.elements[j].addEventListener("blur",this.checkSelectionWrapper)}return this},checkSelection:function(){var h,i;if(this.keepToolbarAlive!==true&&!this.options.disableToolbar){h=d.getSelection();if(h.toString().trim()===""||(this.options.allowMultiParagraphSelection===false&&this.hasMultiParagraphs())){this.hideToolbarActions()}else{i=this.getSelectionElement();if(!i||i.getAttribute("data-disable-toolbar")){this.hideToolbarActions()}else{this.checkSelectionElement(h,i)}}}return this},hasMultiParagraphs:function(){var h=f().replace(/<[\S]+><\/[\S]+>/gim,""),i=h.match(/<(p|h[0-6]|blockquote)>([\s\S]*?)<\/(p|h[0-6]|blockquote)>/g);return(i?i.length:0)},checkSelectionElement:function(h,j){var k;this.selection=h;this.selectionRange=this.selection.getRangeAt(0);for(k=0;k<this.elements.length;k+=1){if(this.elements[k]===j){this.setToolbarButtonStates().setToolbarPosition().showToolbarActions();return}}this.hideToolbarActions()},getSelectionElement:function(){var l=d.getSelection(),i=l.getRangeAt(0),n=i.commonAncestorContainer,k=n.parentNode,h,j=function(q){var o=q;try{while(!o.getAttribute("data-medium-element")){o=o.parentNode}}catch(p){return false}return o};try{if(n.getAttribute("data-medium-element")){h=n}else{h=j(k)}}catch(m){h=j(k)}return h},setToolbarPosition:function(){var l=50,j=d.getSelection(),i=j.getRangeAt(0),n=i.getBoundingClientRect(),h=(this.options.diffLeft)-(this.toolbar.offsetWidth/2),m=(n.left+n.right)/2,k=this.toolbar.offsetWidth/2;if(n.top<l){this.toolbar.classList.add("medium-toolbar-arrow-over");this.toolbar.classList.remove("medium-toolbar-arrow-under");this.toolbar.style.top=l+n.bottom-this.options.diffTop+d.pageYOffset-this.toolbar.offsetHeight+"px"}else{this.toolbar.classList.add("medium-toolbar-arrow-under");this.toolbar.classList.remove("medium-toolbar-arrow-over");this.toolbar.style.top=n.top+this.options.diffTop+d.pageYOffset-this.toolbar.offsetHeight+"px"}if(m<k){this.toolbar.style.left=h+k+"px"}else{if((d.innerWidth-m)<k){this.toolbar.style.left=d.innerWidth+h-k+"px"}else{this.toolbar.style.left=h+m+"px"}}this.hideAnchorPreview();return this},setToolbarButtonStates:function(){var j=this.toolbarActions.querySelectorAll("button"),h;for(h=0;h<j.length;h+=1){j[h].classList.remove("medium-editor-button-active")}this.checkActiveButtons();return this},checkActiveButtons:function(){var h=this.selection.anchorNode;if(!h.tagName){h=this.selection.anchorNode.parentNode}while(h.tagName!==undefined&&this.parentElements.indexOf(h.tagName)===-1){this.activateButton(h.tagName.toLowerCase());h=h.parentNode}},activateButton:function(h){var i=this.toolbar.querySelector('[data-element="'+h+'"]');if(i!==null&&i.className.indexOf("medium-editor-button-active")===-1){i.className+=" medium-editor-button-active"}},bindButtons:function(){var l=this.toolbar.querySelectorAll("button"),k,j=this,h=function(i){i.preventDefault();i.stopPropagation();if(j.selection===undefined){j.checkSelection()}if(this.className.indexOf("medium-editor-button-active")>-1){this.classList.remove("medium-editor-button-active")}else{this.className+=" medium-editor-button-active"}j.execAction(this.getAttribute("data-action"),i)};for(k=0;k<l.length;k+=1){l[k].addEventListener("click",h)}this.setFirstAndLastItems(l);return this},setFirstAndLastItems:function(h){h[0].className+=" medium-editor-button-first";h[h.length-1].className+=" medium-editor-button-last";return this},execAction:function(h,i){if(h.indexOf("append-")>-1){this.execFormatBlock(h.replace("append-",""));this.setToolbarPosition();this.setToolbarButtonStates()}else{if(h==="anchor"){this.triggerAnchorAction(i)}else{if(h==="image"){this.insertImage(this.selection)}else{if(h==="youtube"){this.insertYoutube(this.selection)}else{a.execCommand(h,false,null);this.setToolbarPosition()}}}}},triggerAnchorAction:function(){if(this.selection.anchorNode.parentNode.tagName.toLowerCase()==="a"){a.execCommand("unlink",false,null)}else{if(this.anchorForm.style.display==="block"){this.showToolbarActions()}else{this.showAnchorForm()}}return this},insertYoutube:function(h){var j=h.anchorNode.parentNode;var k=$(j).html();var i=/^(?:https?:\/\/)?(?:www\.)?(?:youtu\.be\/|youtube\.com\/(?:embed\/|v\/|watch\?v=|watch\?.+&v=))((\w|-){11})(?:\S+)?$/;k=(k.match(i))?RegExp.$1:"TuTx4aFCaas";$(j).replaceWith('<div class="medium-remove-content" onclick="$(this).remove();" >remove<iframe class="medium-video" src="//www.youtube.com/embed/'+k+'" allowfullscreen></iframe></div>');this.hideAnchorPreview();return this},insertImage:function(h){var i=h.anchorNode.parentNode;var j=$(i).html();$(i).replaceWith('<div class="medium-remove-content" onclick="$(this).remove();" >remove<img class="medium-image" src="'+j+'"></div>');this.hideAnchorPreview();return this},execFormatBlock:function(h){var i=this.getSelectionData(this.selection.anchorNode);if(h==="blockquote"&&i.el&&i.el.parentNode.tagName.toLowerCase()==="blockquote"){return a.execCommand("outdent",false,null)}if(i.tagName===h){h="p"}return a.execCommand("formatBlock",false,h)},getSelectionData:function(i){var h;if(i&&i.tagName){h=i.tagName.toLowerCase()}while(i&&this.parentElements.indexOf(h)===-1){i=i.parentNode;if(i&&i.tagName){h=i.tagName.toLowerCase()}}return{el:i,tagName:h}},getFirstChild:function(h){var i=h.firstChild;while(i!==null&&i.nodeType!==1){i=i.nextSibling}return i},hideToolbarActions:function(){this.keepToolbarAlive=false;this.toolbar.classList.remove("medium-editor-toolbar-active")},showToolbarActions:function(){var h=this,i;this.anchorForm.style.display="none";this.toolbarActions.style.display="block";this.keepToolbarAlive=false;clearTimeout(i);i=setTimeout(function(){if(!h.toolbar.classList.contains("medium-editor-toolbar-active")){h.toolbar.classList.add("medium-editor-toolbar-active")}},100)},showAnchorForm:function(h){this.toolbarActions.style.display="none";this.savedSelection=c();this.anchorForm.style.display="block";this.keepToolbarAlive=true;this.anchorInput.focus();this.anchorInput.value=h||""},bindAnchorForm:function(){var i=this.anchorForm.querySelector("a"),h=this;this.anchorForm.addEventListener("click",function(j){j.stopPropagation()});this.anchorInput.addEventListener("keyup",function(j){if(j.keyCode===13){j.preventDefault();h.createLink(this)}});this.anchorInput.addEventListener("click",function(j){j.stopPropagation();h.keepToolbarAlive=true});this.anchorInput.addEventListener("blur",function(){h.keepToolbarAlive=false;h.checkSelection()});i.addEventListener("click",function(j){j.preventDefault();h.showToolbarActions();e(h.savedSelection)});return this},hideAnchorPreview:function(){this.anchorPreview.classList.remove("medium-editor-anchor-preview-active")},showAnchorPreview:function(j){if(this.anchorPreview.classList.contains("medium-editor-anchor-preview-active")){return true}var i=this,l=40,o=j.getBoundingClientRect(),h=(i.options.diffLeft)-(i.anchorPreview.offsetWidth/2),n=(o.left+o.right)/2,k=i.anchorPreview.offsetWidth/2,m;clearTimeout(m);m=setTimeout(function(){if(!i.anchorPreview.classList.contains("medium-editor-anchor-preview-active")){i.anchorPreview.classList.add("medium-editor-anchor-preview-active")}},100);i.anchorPreview.querySelector("i").innerHTML=j.href;i.observeAnchorPreview(j);i.anchorPreview.classList.add("medium-toolbar-arrow-over");i.anchorPreview.classList.remove("medium-toolbar-arrow-under");i.anchorPreview.style.top=Math.round(l+o.bottom-i.options.diffTop+d.pageYOffset-i.anchorPreview.offsetHeight)+"px";if(n<k){i.anchorPreview.style.left=h+k+"px"}else{if((d.innerWidth-n)<k){i.anchorPreview.style.left=d.innerWidth+h-k+"px"}else{i.anchorPreview.style.left=h+n+"px"}}return this},observeAnchorPreview:function(n){var h=this,m=(new Date()).getTime(),l=true,i=function(){m=(new Date()).getTime();l=true},j=function(o){if(!o.relatedTarget||!/anchor-preview/.test(o.relatedTarget.className)){l=false}},k=setInterval(function(){if(l){return true}var o=(new Date()).getTime()-m;if(o>500){h.hideAnchorPreview();clearInterval(k);h.anchorPreview.removeEventListener("mouseover",i);h.anchorPreview.removeEventListener("mouseout",j);n.removeEventListener("mouseover",i);n.removeEventListener("mouseout",j)}},200);h.anchorPreview.addEventListener("mouseover",i);h.anchorPreview.addEventListener("mouseout",j);n.addEventListener("mouseover",i);n.addEventListener("mouseout",j)},createAnchorPreview:function(){var h=this,i=a.createElement("div");i.id="medium-editor-anchor-preview-"+this.id;i.className="medium-editor-anchor-preview";i.innerHTML=this.anchorPreviewTemplate();a.getElementsByTagName("body")[0].appendChild(i);i.addEventListener("click",function(){h.anchorPreviewClickHandler()});return i},anchorPreviewTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <i class="medium-editor-toolbar-anchor-preview-inner">http://google.com/</i></div>'},anchorPreviewClickHandler:function(k){if(this.activeAnchor){var i=this,h=a.createRange(),j=d.getSelection();h.selectNodeContents(i.activeAnchor);j.removeAllRanges();j.addRange(h);setTimeout(function(){i.showAnchorForm(i.activeAnchor.href);i.keepToolbarAlive=false},100)}this.hideAnchorPreview()},editorAnchorObserver:function(h){if(h.target&&h.target.tagName.toLowerCase()==="a"){if(this.toolbar.classList.contains("medium-editor-toolbar-active")){return true}this.activeAnchor=h.target;this.showAnchorPreview(h.target)}},bindAnchorPreview:function(i){var h=this;this.elements[i].addEventListener("mouseover",function(j){h.editorAnchorObserver(j)});return this},setTargetBlank:function(){var j=b(),h;if(j.tagName.toLowerCase()==="a"){j.target="_blank"}else{j=j.getElementsByTagName("a");for(h=0;h<j.length;h+=1){j[h].target="_blank"}}},createLink:function(h){e(this.savedSelection);a.execCommand("createLink",false,h.value);if(this.options.targetBlank){this.setTargetBlank()}this.showToolbarActions();h.value=""},bindWindowActions:function(){var h,i=this;this.windowResizeHandler=function(){clearTimeout(h);h=setTimeout(function(){if(i.toolbar.classList.contains("medium-editor-toolbar-active")){i.setToolbarPosition()}},100)};d.addEventListener("resize",this.windowResizeHandler);return this},activate:function(){var h;if(this.isActive){return}if(this.toolbar!==undefined){this.toolbar.style.display="block"}this.isActive=true;for(h=0;h<this.elements.length;h+=1){this.elements[h].setAttribute("contentEditable",true)}this.bindWindowActions().bindSelect()},deactivate:function(){var h;if(!this.isActive){return}this.isActive=false;if(this.toolbar!==undefined){this.toolbar.style.display="none"}a.documentElement.removeEventListener("mouseup",this.checkSelectionWrapper);d.removeEventListener("resize",this.windowResizeHandler);for(h=0;h<this.elements.length;h+=1){this.elements[h].removeEventListener("keyup",this.checkSelectionWrapper);this.elements[h].removeEventListener("blur",this.checkSelectionWrapper);this.elements[h].removeEventListener("paste",this.pasteWrapper);this.elements[h].removeAttribute("contentEditable")}},bindPaste:function(){if(!this.options.forcePlainText){return this}var j,h=this;this.pasteWrapper=function(m){var k,i="",l;this.classList.remove("medium-editor-placeholder");if(m.clipboardData&&m.clipboardData.getData){m.preventDefault();if(!h.options.disableReturn){k=m.clipboardData.getData("text/plain").split(/[\r\n]/g);for(l=0;l<k.length;l+=1){if(k[l]!==""){i+="<p>"+k[l]+"</p>"}}a.execCommand("insertHTML",false,i)}else{a.execCommand("insertHTML",false,m.clipboardData.getData("text/plain"))}}};for(j=0;j<this.elements.length;j+=1){this.elements[j].addEventListener("paste",this.pasteWrapper)}return this},setPlaceholders:function(){var j,h=function(i){if(i.textContent.replace(/^\s+|\s+$/g,"")===""){i.classList.add("medium-editor-placeholder")}},k=function(i){this.classList.remove("medium-editor-placeholder");if(i.type!=="keypress"){h(this)}};for(j=0;j<this.elements.length;j+=1){h(this.elements[j]);this.elements[j].addEventListener("blur",k);this.elements[j].addEventListener("keypress",k)}return this}}}(window,document));